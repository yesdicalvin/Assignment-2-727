---
title: "Assignment 2 727"
author: "Aulia Dini & Yesdi Calvin"
date: "2023-10-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r, message = FALSE}
# open library
library(tidyverse)
library(gtrendsR)
library(censusapi)
library(dplyr)
library(ggplot2)
```

## **Pulling from APIs**

Our first data source is the Google Trends API. Suppose we are interested in the search trends for crime and loans in Illinois in the year 2020. We could find this using the following code:

```{r}
set.seed(727)
res <- gtrends(c("crime", "loans"), 
              geo = "US-IL", 
            time = "2020-01-01 2020-12-31", 
            low_search_volume = TRUE)
```


### Answer the following questions for the keywords “crime” and “loans”.

### 1. Find the mean, median and variance of the search hits for the keywords.

```{r}
# change the tibble into long format
res_time_w <- pivot_wider(res$interest_over_time, 
                          names_from = keyword, 
                          values_from = hits)
head(res_time_w)
```

```{r}
# change the long format into the wide format
res_time_w <- res_time_w %>%
  pivot_longer(6:7, names_to = "keyword", values_to = "hits")
```

```{r}
# compute mean, median, var of hits
res_time_w %>%
  group_by(keyword) %>%
  summarize(mean_hits=mean(hits), 
            med_hits=median(hits),
            var_sd=var(hits))
```

Analysis :

The summary statistics describe the search popularity of `crime` and `loans` in Illinois from January 1, 2020, to December 31, 2020. The mean of `loans` hits is higher than `crime` hits, with the value of 65.9 and 54.3. The mean from `loans` and `crime` search hits has a small discrepancy with the median, meaning there are no influential observations in the datasets. The variance of `loans` hits is higher than `crime` hits.  


### 2. Which cities (locations) have the highest search frequency for `loans`? Note that there might be multiple rows for each city if there were hits for both "crime" and "loans" in that city. It might be easier to answer this question if we had the search hits info for both search terms in two separate variables. That is, each row would represent a unique city.


```{r}
# change the data format into wide format
res_city_loans <- res$interest_by_city %>%
  pivot_wider(names_from = keyword,
              values_from= hits)%>%

# sort the data by the value of search hits of loans
arrange(desc(loans))

# print the result 
print(res_city_loans)
```

The locations with highest value of hits for `loans` in Illinois are Alorton, Rosemont, and Coal City. 

### 3. Is there a relationship between the search intensities between the two keywords we used?

```{r}
# create plot for res
plot(res)
```


```{r}
# compute correlation and do correlation test for  median income with coronavirus 
corr_test_res <-cor.test(res_city_loans$crime, res_city_loans$loans)
print(corr_test_res)
```

Analysis : 

We can diagnose the relationship of search hits between these two keywords by looking at the plot above. There is a pattern between these two variables, which indicates a relationship. From January to October 2020, generally, they moved to different direction although after that until December 2020 they tend to had same direction. In other words, we can diagnose that there is a negative significant relationship. To make sure, we need to test it using the pearson correlation test. The correlation of hits between `crime` and `loans` is -0.54. There is a significant and negative relationship between the search intensities between `crime` and `loans`. As the search for `crime` is high, the search for `loans` is low.

### Repeat the above for keywords related to covid. Make sure you use multiple keywords like we did above. Try several different combinations and think carefully about words that might make sense within this context.

We try to use `coronavirus` and `hospital` as keywords. 

```{r}
set.seed(727)
cov <- gtrends(c("coronavirus", "hospital"), 
               geo = "US-IL", 
               time = "2020-01-01 2020-12-31", 
               low_search_volume = TRUE)
```


### 1. Compute mean, median, and variance of hits related to `coronavirus` and `hospital`.  

```{r, warning=FALSE}
# change the data format of interest over time into tibble
res_cov <- as_tibble(cov$interest_over_time)
as.numeric(res_cov$hits)

# remove the value of hits with less than 1
res_cov_sub <- subset(res_cov, hits >= 1)

# change the format of hits into numeric
res_cov_sub$hits <- as.numeric(res_cov_sub$hits)

# compute mean, median, var of hits
res_cov_sub %>%
  group_by(keyword) %>%
  summarize(mean_hits=mean(hits), 
            med_hits=median(hits),
            var_sd=var(hits))
```

Analysis:

The mean of `coronavirus` hits is higher than hospital hits, with values of  15.8 and 3.8. A high discrepancy between the mean and median of `coronavirus` hits indicates the extremely high popularity of `coronavirus` searches at certain times. The variance of the `coronavirus` search is higher than the `hospital` search, with values of 426.16 and 0.21.

### 2. Find cities with highest hits of `coronavirus`

```{r}
# change the data format into wide format
 cov_city <- cov$interest_by_city 
 cov_city <-  cov_city[!duplicated(cov_city), ] #remove duplication

  cov_city_hos <- cov_city %>%
  pivot_wider(names_from = keyword,
  values_from = hits) %>%
    
# sort the data by the value of search hits of coronavirus
arrange(desc(coronavirus))

```

```{r}
# print the result 
print(cov_city_hos)
```

The cities with highest hits of `coronavirus` in Illinois are Ullin, Clarendon Hills, and Belknap.  
