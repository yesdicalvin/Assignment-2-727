---
title: "Assignment 2 727"
author: "Aulia Dini & Yesdi Calvin"
date: "2023-10-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r, message = FALSE}
# open library
library(tidyverse)
library(gtrendsR)
library(censusapi)
library(dplyr)
library(ggplot2)
```

## **Pulling from APIs**

Our first data source is the Google Trends API. Suppose we are interested in the search trends for crime and loans in Illinois in the year 2020. We could find this using the following code:

```{r}
set.seed(727)
res <- gtrends(c("crime", "loans"), 
              geo = "US-IL", 
            time = "2020-01-01 2020-12-31", 
            low_search_volume = TRUE)
```


### Answer the following questions for the keywords “crime” and “loans”.

### 1. Find the mean, median and variance of the search hits for the keywords.

```{r}
# change the tibble into long format
res_time_w <- pivot_wider(res$interest_over_time, 
                          names_from = keyword, 
                          values_from = hits)
head(res_time_w)
```

```{r}
# change the long format into the wide format
res_time_w <- res_time_w %>%
  pivot_longer(6:7, names_to = "keyword", values_to = "hits")
```

```{r}
# compute mean, median, var of hits
res_time_w %>%
  group_by(keyword) %>%
  summarize(mean_hits=mean(hits), 
            med_hits=median(hits),
            var_sd=var(hits))
```

Analysis :

The summary statistics describe the search popularity of `crime` and `loans` in Illinois from January 1, 2020, to December 31, 2020. The mean of `loans` hits is higher than `crime` hits, with the value of 65.9 and 54.3. The mean from `loans` and `crime` search hits has a small discrepancy with the median, meaning there are no influential observations in the datasets. The variance of `loans` hits is higher than `crime` hits.  


### 2. Which cities (locations) have the highest search frequency for `loans`? Note that there might be multiple rows for each city if there were hits for both "crime" and "loans" in that city. It might be easier to answer this question if we had the search hits info for both search terms in two separate variables. That is, each row would represent a unique city.


```{r}
# change the data format into wide format
res_city_loans <- res$interest_by_city %>%
  pivot_wider(names_from = keyword,
              values_from= hits)%>%

# sort the data by the value of search hits of loans
arrange(desc(loans))

# print the result 
print(res_city_loans)
```